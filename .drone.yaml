kind: pipeline
type: docker
name: build

steps:
- name: build
  image: golang:1.12
  commands:
  - go build
  when:
    ref:
    - refs/tags/latest
    - refs/tags/v*

- name: build-images-push-nexus
  image: plugins/docker
  settings: 
    username: 
      from_secret: docker_username
    password: 
      from_secret: docker_password
    repo: 104.214.48.227:5000/wei-xiang-chen/club
    registry: 104.214.48.227:5000
    insecure: true
    auto_tag: true
  when:
    ref:
    - refs/tags/latest
    - refs/tags/v*

# - name: deploy
#   image: 104.214.48.227:5000/wei-xiang-chen/club
#   pull: if-not-exists
#   settings:
#     namespace: erp-backend-uat
#     deployment: svc-eft-customer-api
#     repo: 104.214.48.227:5000/wei-xiang-chen/club
#     container: club
#     tag: ${DRONE_SEMVER}
#   when:
#     ref:
#     - refs/tags/latest
#     - refs/tags/v*
